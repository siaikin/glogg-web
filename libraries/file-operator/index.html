<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Title</title>
    <script src="dist/esm/bundle/index.js"></script>
  </head>
  <body>
    <label>
      <input id="file-select" type="file" />
    </label>

    <script>
      const { BlobReaderFactory } = BLOB_READER_FACTORY;
      const factory = BlobReaderFactory.getInstance({
        baseUrl: "dist/esm/worker/bundle",
        readerFragment: {
          lines: 1024
        }
      });
      const fileInput = document.getElementById("file-select");

      fileInput.addEventListener("change", async () => {
        const file = fileInput.files[0];
        const reader = factory.getReader(file);

        reader.addEventListener("blob-load-progress", ({message}) => {
          console.log(message.data.loaded / message.data.total);
        });

        await reader.loaded;

        console.log(reader.readLines(0, 999))
        // for (let i = 0; i < reader.size; i++) {
        //   const f = reader.requestFragment(i);
        //   const results = await f.toTextArray();
        //
        //   console.log(`
        //   loadArrayBufferDuration: ${f.loadArrayBufferDuration},
        //   decodeTextDuration: ${f.decodeTextDuration}
        //   `);
        // }
      });
    </script>
  </body>
</html>
